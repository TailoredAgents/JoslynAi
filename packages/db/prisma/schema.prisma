generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Minimal schema for Phase 1 vertical slice

model Children {
  id        String   @id @default(uuid()) @db.Uuid
  org_id    String?  @db.Uuid
  name      String
  dob       DateTime?
  created_at DateTime @default(now())

  @@map("children")
}

model Documents {
  id          String   @id @default(uuid()) @db.Uuid
  child_id    String   @db.Uuid
  type        String
  storage_uri String
  sha256      String
  doc_tags    Json
  original_name String?
  created_at  DateTime @default(now())

  @@map("documents")
}

model DocSpan {
  id           String   @id @default(uuid()) @db.Uuid
  document_id  String   @db.Uuid
  page         Int
  bbox         String?
  text         String
  created_at   DateTime @default(now())

  @@map("doc_spans")
}

model IepExtract {
  id                   String   @id @default(uuid()) @db.Uuid
  document_id          String   @unique @db.Uuid
  services_json        Json
  goals_json           Json
  accommodations_json  Json
  placement            String?
  start_date           DateTime?
  end_date             DateTime?
  notes                String?
  created_at           DateTime @default(now())

  @@map("iep_extract")
}

// Phase 2 additions

model timeline_rules {
  id            String   @id @default(uuid()) @db.Uuid
  jurisdiction  String
  kind          String
  delta_days    Int
  description   String?
  source_url    String?
  active        Boolean  @default(true)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  @@index([jurisdiction, kind])
  @@unique([jurisdiction, kind])
}

model deadlines {
  id            String   @id @default(uuid()) @db.Uuid
  child_id      String
  kind          String
  base_date     DateTime
  due_date      DateTime
  jurisdiction  String
  source_doc_id String?
  created_at    DateTime @default(now())
}

model letters {
  id          String   @id @default(uuid()) @db.Uuid
  child_id    String
  kind        String
  status      String   @default("draft")
  draft_json  Json
  pdf_uri     String?
  sent_via    String?
  sent_at     DateTime?
  created_at  DateTime @default(now())
}

model claims {
  id                   String   @id @default(uuid()) @db.Uuid
  child_id             String
  service_date         DateTime?
  provider             String?
  amounts_json         Json?
  status               String   @default("open")
  linked_document_ids  Json?
  created_at           DateTime @default(now())
}

model eobs {
  id             String   @id @default(uuid()) @db.Uuid
  claim_id       String
  document_id    String
  parsed_json    Json?
  explanation_text String?
  created_at     DateTime @default(now())

  @@unique([document_id])
}
